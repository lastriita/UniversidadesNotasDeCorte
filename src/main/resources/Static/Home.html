<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Foro de Universidades</title>
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/css/bootstrap.min.css"
          integrity="sha384-DhY6onE6f3zzKbjUPRc2hOzGAdEf4/Dz+WJwBvEYL/lkkIsI3ihufq9hk9K4lVoK"
          crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href="home.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
<aside>
    <ul>
        <li><a href="/login.html">Login</a></li>
        <li><a href="/contact.html?name=&email=&subject=&message=">Contact</a></li>
    </ul>
</aside>
<div class="content" style="margin-left:23%;padding:1px 16px;height:1000px;">
<div class="container">
    <div class="row">
        <div class="col-12">
            <h1>Foro Universidades</h1>
        </div>
    </div>
    <div class="input-group">
        <input type="search" class="form-control rounded" placeholder="Search" aria-label="Search"
               aria-describedby="search-addon" id="buscar"/>
        <button type="submit" class="btn btn-outline-primary" onclick="buscar()">search</button>
    </div>
    <div id="content"></div>
</div>
</div>

<script type="text/javascript">

    function showContent(arrData, div) {

        var html = '';

        arrData.forEach(e => {
            var url = 'detailUni.html?uni=' + e.name

            html+=
            `<div class="carta">`+
            `<div class="card">`+
            `<a class="card-block stretched-link text-decoration-none" href="${url}">`+
                `<img class="card-img-top icon" src="${e.img}" alt="Card image cap">\n`+
                `</a>`+
                `<div class="card-body">`+
                `<a class="card-block stretched-link text-decoration-none" href="${url}">`+
                    `<h5 class="card-title margenes">${e.name}</h5>`+
                `</a>`+
                `</div>`+
            `</div>`+
            `</div>`;
        });

        document.getElementById(div).innerHTML = html;
        var images = $(".icon");

        $(images).on("error", function(event) {
            $(event.target).css("display", "none");
        });
    }

    function getUnis() {
        var headers = {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                };
        fetch("/universidades", {
                method: 'GET',
                headers: headers
            })
            .then(response => response.json())
            .then(data => {
                showContent(data,"content")
                console.log(data)
            });
    }

    function searchUnis() {
        var headers = {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                };
        fetch(link, {
                method: 'GET',
                headers: headers
            })
            .then(response => response.json())
            .then(data => {
                showContent(data,"content")
                console.log(data)
            });
    }

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    var uni = urlParams.get('search')
    console.log(uni)

    if(uni==null){
        getUnis();
    }else{
        link="/search/"+uni
        searchUnis()
        document.getElementById("buscar").value = uni;
    }

    function buscar(){
        var buscar = document.getElementById("buscar").value
        if(buscar==""){
            document.location.href="/home.html";
        }else{
            document.location.href="/home.html?search="+buscar;
        }
    }

</script>
</body>
</html>